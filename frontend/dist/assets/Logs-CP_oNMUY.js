import{_ as te}from"./_plugin-vue_export-helper-DRcqrMy4.js";/* empty css                   *//* empty css                *//* empty css                     *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                 *//* empty css                  */import{a4 as k,d as se,r as s,o as ne,x as z,c as oe,e as o,g as i,w as m,a8 as ie,f as n,l as F,ah as $,ai as ue,k as O,P as V,O as R,af as ce,n as re,p as ve,T as G,aL as de,au as pe,t as p,ay as ge,aF as _e,s as K,q as me,ap as fe,j as t,az as T,ax as he}from"./index-Bf3lHhEM.js";const B={getDates:()=>k.get("/logs/dates").then(u=>u.data),getFiles:u=>k.get(`/logs/files/${u}`).then(c=>c.data),getContent:(u,c,r)=>k.get(`/logs/content/${u}/${c}`,{params:r}).then(g=>g.data),getStats:()=>k.get("/logs/stats").then(u=>u.data)},ye={class:"logs-page"},Ce={class:"card-header"},Ee={class:"actions"},we={class:"logs-container"},xe={class:"file-list"},ke=["onClick"],Fe={class:"file-name"},Ve={class:"file-meta"},Re={class:"log-content"},Be={class:"log-toolbar"},Se={class:"log-count"},be={class:"log-entries"},De={class:"log-time"},Ne={class:"log-msg"},ze={key:0,class:"log-pagination"},Oe={key:0,class:"log-stats"},Le=se({__name:"Logs",setup(u){const c=s([]),r=s([]),g=s([]),f=s(null),C=s(!1),h=s(!1),_=s(""),v=s(null),S=s(""),b=s(""),E=s(0),w=s(100),d=s(1),W=[{value:"",label:"全部级别"},{value:"DEBUG",label:"DEBUG"},{value:"INFO",label:"INFO"},{value:"WARN",label:"WARN"},{value:"ERROR",label:"ERROR"}];ne(async()=>{await Promise.all([j(),q()])});async function j(){try{const a=await B.getDates();c.value=a.dates||[],c.value.length>0&&!_.value&&(_.value=c.value[0],await L())}catch{z.error("获取日期列表失败")}}async function L(){if(_.value){C.value=!0;try{const a=await B.getFiles(_.value);r.value=a.files||[],r.value.length>0?(v.value=r.value[0],await y()):(v.value=null,g.value=[])}catch{z.error("获取日志文件列表失败")}finally{C.value=!1}}}async function y(){if(v.value){h.value=!0;try{const a=await B.getContent(v.value.date,v.value.name,{limit:w.value,offset:(d.value-1)*w.value,level:b.value||void 0,search:S.value||void 0});g.value=a.entries||[],E.value=a.total}catch{z.error("获取日志内容失败")}finally{h.value=!1}}}async function q(){try{f.value=await B.getStats()}catch{}}function H(){d.value=1,L()}function J(a){v.value=a,d.value=1,y()}function D(){d.value=1,y()}function Q(a){d.value=a,y()}function P(a){return a<1024?a+" B":a<1024*1024?(a/1024).toFixed(1)+" KB":(a/1024/1024).toFixed(1)+" MB"}function X(a){return{DEBUG:"level-debug",INFO:"level-info",WARN:"level-warn",ERROR:"level-error"}[a]||""}const Y=oe(()=>Math.ceil(E.value/w.value));return(a,l)=>{const U=he,I=pe,Z=me,A=ce,ee=re,ae=ge,N=_e,le=ie,M=ue;return t(),o("div",ye,[i(le,null,{header:m(()=>[n("div",Ce,[l[5]||(l[5]=n("span",{class:"title"},"系统日志",-1)),n("div",Ee,[i(I,{modelValue:_.value,"onUpdate:modelValue":l[0]||(l[0]=e=>_.value=e),placeholder:"选择日期",style:{width:"150px"},onChange:H},{default:m(()=>[(t(!0),o(V,null,R(c.value,e=>(t(),O(U,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(Z,{icon:G(fe),onClick:y,loading:h.value},{default:m(()=>[...l[4]||(l[4]=[K("刷新",-1)])]),_:1},8,["icon","loading"])])])]),default:m(()=>[n("div",we,[$((t(),o("div",xe,[l[6]||(l[6]=n("div",{class:"file-list-header"},"日志文件",-1)),(t(!0),o(V,null,R(r.value,e=>{var x;return t(),o("div",{key:e.name,class:T(["file-item",{active:((x=v.value)==null?void 0:x.name)===e.name}]),onClick:Pe=>J(e)},[n("div",Fe,p(e.name),1),n("div",Ve,p(P(e.size)),1)],10,ke)}),128)),!C.value&&r.value.length===0?(t(),O(A,{key:0,description:"暂无日志文件","image-size":60})):F("",!0)])),[[M,C.value]]),n("div",Re,[n("div",Be,[i(ee,{modelValue:S.value,"onUpdate:modelValue":l[1]||(l[1]=e=>S.value=e),placeholder:"搜索日志内容","prefix-icon":G(de),clearable:"",style:{width:"250px"},onKeyup:ve(D,["enter"]),onClear:D},null,8,["modelValue","prefix-icon"]),i(I,{modelValue:b.value,"onUpdate:modelValue":l[2]||(l[2]=e=>b.value=e),placeholder:"日志级别",style:{width:"120px"},onChange:D},{default:m(()=>[(t(),o(V,null,R(W,e=>i(U,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),n("span",Se,"共 "+p(E.value)+" 条",1)]),$((t(),o("div",be,[(t(!0),o(V,null,R(g.value,(e,x)=>(t(),o("div",{key:x,class:"log-entry"},[n("span",De,p(e.time),1),n("span",{class:T(["log-level",X(e.level)])},p(e.level),3),n("span",Ne,p(e.msg||e.raw),1)]))),128)),!h.value&&g.value.length===0?(t(),O(A,{key:0,description:"暂无日志"})):F("",!0)])),[[M,h.value]]),Y.value>1?(t(),o("div",ze,[i(ae,{"current-page":d.value,"onUpdate:currentPage":l[3]||(l[3]=e=>d.value=e),"page-size":w.value,total:E.value,layout:"prev, pager, next",onCurrentChange:Q},null,8,["current-page","page-size","total"])])):F("",!0)])]),f.value?(t(),o("div",Oe,[i(N,{title:"日志天数",value:f.value.dateCount},null,8,["value"]),i(N,{title:"文件数量",value:f.value.fileCount},null,8,["value"]),i(N,{title:"总大小"},{default:m(()=>[K(p(P(f.value.totalSize)),1)]),_:1})])):F("",!0)]),_:1})])}}}),Je=te(Le,[["__scopeId","data-v-56160692"]]);export{Je as default};
