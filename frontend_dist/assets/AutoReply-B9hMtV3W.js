import{_ as K}from"./_plugin-vue_export-helper-DRcqrMy4.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                *//* empty css                 *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css                        *//* empty css                  *//* empty css                  */import{a4 as v,d as Q,r as _,o as W,x as r,e as M,g as a,w as n,a8 as X,ag as Y,ah as Z,k as C,l as E,ai as ee,ac as ae,ae as te,s as b,t as le,aC as ne,aj as oe,q as ue,T as x,aD as ie,ao as re,ab as se,af as de,f as g,ap as pe,aq as me,E as ce,m as fe,n as ve,au as _e,P as ye,O as he,aE as be,ar as ge,j as m,ax as Ve}from"./index-Bf3lHhEM.js";const V={list:()=>v.get("/autoreply").then(i=>i.data),get:i=>v.get(`/autoreply/${i}`).then(u=>u.data),create:i=>v.post("/autoreply",i).then(u=>u.data),update:(i,u)=>v.put(`/autoreply/${i}`,u).then(s=>s.data),delete:i=>v.delete(`/autoreply/${i}`).then(u=>u.data),setEnabled:(i,u)=>v.patch(`/autoreply/${i}/enabled`,{enabled:u}).then(s=>s.data)},we={class:"autoreply-page"},Ce={class:"card-header"},Ee={class:"actions"},xe={key:0,class:"form-tip"},Te=Q({__name:"AutoReply",setup(i){const u=_([]),s=_(!1),c=_(!1),y=_(null),T=_(!1),l=_({name:"",matchType:"contains",matchPattern:"",replyContent:"",priority:0,excludeMatch:!1}),P=[{value:"exact",label:"精确匹配"},{value:"contains",label:"包含关键词"},{value:"regex",label:"正则表达式"},{value:"ai",label:"AI 智能回复"}];W(()=>{h()});async function h(){s.value=!0;try{const o=await V.list();u.value=o.rules||[]}catch{r.error("获取规则列表失败")}finally{s.value=!1}}function $(){y.value=null,l.value={name:"",matchType:"contains",matchPattern:"",replyContent:"",priority:0,excludeMatch:!1},c.value=!0}function A(o){y.value=o,l.value={name:o.name,matchType:o.matchType,matchPattern:o.matchPattern,replyContent:o.replyContent,priority:o.priority,excludeMatch:o.excludeMatch},c.value=!0}async function B(){if(!l.value.name){r.warning("请填写规则名称");return}if(l.value.matchType!=="ai"){if(!l.value.matchPattern){r.warning("请填写匹配内容");return}if(!l.value.replyContent){r.warning("请填写回复内容");return}}T.value=!0;try{y.value?(await V.update(y.value.id,l.value),r.success("更新成功")):(await V.create(l.value),r.success("创建成功")),c.value=!1,h()}catch{r.error("操作失败")}finally{T.value=!1}}async function I(o){try{await V.setEnabled(o.id,!o.enabled),r.success(o.enabled?"已禁用":"已启用"),h()}catch{r.error("操作失败")}}async function q(o){try{await ge.confirm(`确定删除规则 "${o.name}"？`,"确认删除",{type:"warning"}),await V.delete(o.id),r.success("删除成功"),h()}catch(e){e!=="cancel"&&r.error("删除失败")}}function D(o){var e;return((e=P.find(d=>d.value===o))==null?void 0:e.label)||o}return(o,e)=>{const d=ue,p=ae,N=te,U=ne,R=oe,S=se,F=de,L=X,k=ve,f=fe,O=Ve,j=_e,z=be,G=ce,H=Y,J=ee;return m(),M("div",we,[a(L,null,{header:n(()=>[g("div",Ce,[e[10]||(e[10]=g("span",{class:"title"},"自动回复规则",-1)),g("div",Ee,[a(d,{icon:x(pe),onClick:h,loading:s.value},{default:n(()=>[...e[8]||(e[8]=[b("刷新",-1)])]),_:1},8,["icon","loading"]),a(d,{type:"primary",icon:x(me),onClick:$},{default:n(()=>[...e[9]||(e[9]=[b("添加规则",-1)])]),_:1},8,["icon"])])])]),default:n(()=>[Z((m(),C(S,{data:u.value,stripe:""},{default:n(()=>[a(p,{label:"规则名称",prop:"name","min-width":"150"}),a(p,{label:"匹配类型",width:"120"},{default:n(({row:t})=>[a(N,{size:"small"},{default:n(()=>[b(le(D(t.matchType)),1)]),_:2},1024)]),_:1}),a(p,{label:"匹配内容",prop:"matchPattern","min-width":"150","show-overflow-tooltip":""}),a(p,{label:"回复内容",prop:"replyContent","min-width":"200","show-overflow-tooltip":""}),a(p,{label:"优先级",prop:"priority",width:"80",align:"center"}),a(p,{label:"状态",width:"80",align:"center"},{default:n(({row:t})=>[a(U,{modelValue:t.enabled,"onUpdate:modelValue":w=>t.enabled=w,onChange:w=>I(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(p,{label:"操作",width:"120",align:"center"},{default:n(({row:t})=>[a(R,null,{default:n(()=>[a(d,{icon:x(ie),onClick:w=>A(t)},null,8,["icon","onClick"]),a(d,{icon:x(re),type:"danger",onClick:w=>q(t)},null,8,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[J,s.value]]),!s.value&&u.value.length===0?(m(),C(F,{key:0,description:"暂无规则"})):E("",!0)]),_:1}),a(H,{modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=t=>c.value=t),title:y.value?"编辑规则":"添加规则",width:"600px"},{footer:n(()=>[a(d,{onClick:e[6]||(e[6]=t=>c.value=!1)},{default:n(()=>[...e[13]||(e[13]=[b("取消",-1)])]),_:1}),a(d,{type:"primary",onClick:B,loading:T.value},{default:n(()=>[...e[14]||(e[14]=[b("确定",-1)])]),_:1},8,["loading"])]),default:n(()=>[a(G,{"label-width":"100px"},{default:n(()=>[a(f,{label:"规则名称",required:""},{default:n(()=>[a(k,{modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.name=t),placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),a(f,{label:"匹配类型",required:""},{default:n(()=>[a(j,{modelValue:l.value.matchType,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.matchType=t),style:{width:"100%"}},{default:n(()=>[(m(),M(ye,null,he(P,t=>a(O,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),l.value.matchType==="ai"?(m(),M("div",xe,"AI 模式将使用系统设置中的 AI 配置自动生成回复")):E("",!0)]),_:1}),l.value.matchType!=="ai"?(m(),C(f,{key:0,label:"匹配内容",required:""},{default:n(()=>[a(k,{modelValue:l.value.matchPattern,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.matchPattern=t),placeholder:"请输入匹配内容"},null,8,["modelValue"])]),_:1})):E("",!0),l.value.matchType!=="ai"?(m(),C(f,{key:1,label:"回复内容",required:""},{default:n(()=>[a(k,{modelValue:l.value.replyContent,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.replyContent=t),type:"textarea",rows:4,placeholder:"请输入回复内容"},null,8,["modelValue"])]),_:1})):E("",!0),a(f,{label:"优先级"},{default:n(()=>[a(z,{modelValue:l.value.priority,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.priority=t),min:0,max:100},null,8,["modelValue"]),e[11]||(e[11]=g("span",{class:"form-tip"},"数值越大优先级越高",-1))]),_:1}),a(f,{label:"排除匹配"},{default:n(()=>[a(U,{modelValue:l.value.excludeMatch,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.excludeMatch=t)},null,8,["modelValue"]),e[12]||(e[12]=g("span",{class:"form-tip"},"启用后，匹配到的消息将不回复",-1))]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}}),Ge=K(Te,[["__scopeId","data-v-b0407148"]]);export{Ge as default};
