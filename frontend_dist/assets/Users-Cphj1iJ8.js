import{_ as Q}from"./_plugin-vue_export-helper-DRcqrMy4.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                  */import{a4 as p,d as W,u as X,c as Z,r as f,a as I,o as ee,e as ae,f as R,ah as te,g as a,w as l,q as le,ai as se,k as oe,ag as re,ab as ne,s as u,Y as de,a1 as ue,ac as ie,ae as me,t as pe,aC as fe,E as ce,m as we,n as ge,au as _e,ax as ve,x as V,ar as be,j as B}from"./index-Bf3lHhEM.js";const b={list:()=>p.get("/admin/users").then(s=>s.data),get:s=>p.get(`/admin/users/${s}`).then(r=>r.data),create:s=>p.post("/admin/users",s).then(r=>r.data),update:(s,r)=>p.put(`/admin/users/${s}`,r).then(d=>d.data),delete:s=>p.delete(`/admin/users/${s}`).then(r=>r.data),setEnabled:(s,r)=>p.patch(`/admin/users/${s}/enabled`,{enabled:r}).then(d=>d.data),resetPassword:(s,r)=>p.post(`/admin/users/${s}/reset-password`,{newPassword:r}).then(d=>d.data)},ye={class:"users-page"},Ve={class:"page-header"},Ee=W({__name:"Users",setup(s){const r=X(),d=Z(()=>r.user),U=f([]),E=f(!1),c=f(!1),g=f(!1),C=f(),n=I({username:"",password:"",role:"user"}),q={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]},_=f(!1),P=f(),i=I({userId:0,newPassword:""}),S={newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}]};async function k(){E.value=!0;try{const o=await b.list();U.value=o.users}finally{E.value=!1}}function T(){n.username="",n.password="",n.role="user",g.value=!0}async function A(){C.value&&await C.value.validate(async o=>{if(o){c.value=!0;try{await b.create(n),V.success("用户创建成功"),g.value=!1,k()}finally{c.value=!1}}})}async function M(o,e){try{await b.setEnabled(o.id,e),o.enabled=e,V.success(e?"用户已启用":"用户已禁用")}catch{}}async function N(o){try{await be.confirm(`确定要删除用户 "${o.username}" 吗？`,"确认删除",{type:"warning"}),await b.delete(o.id),V.success("用户已删除"),k()}catch{}}function z(o){i.userId=o.id,i.newPassword="",_.value=!0}async function j(){P.value&&await P.value.validate(async o=>{if(o){c.value=!0;try{await b.resetPassword(i.userId,i.newPassword),V.success("密码已重置"),_.value=!1}finally{c.value=!1}}})}return ee(()=>{k()}),(o,e)=>{const L=ue("Plus"),O=de,m=le,w=ie,Y=me,G=fe,H=ne,h=ge,y=we,$=ve,J=_e,D=ce,F=re,K=se;return B(),ae("div",ye,[R("div",Ve,[e[9]||(e[9]=R("h2",null,"用户管理",-1)),a(m,{type:"primary",onClick:T},{default:l(()=>[a(O,null,{default:l(()=>[a(L)]),_:1}),e[8]||(e[8]=u(" 添加用户 ",-1))]),_:1})]),te((B(),oe(H,{data:U.value,stripe:""},{default:l(()=>[a(w,{prop:"id",label:"ID",width:"80"}),a(w,{prop:"username",label:"用户名"}),a(w,{prop:"role",label:"角色",width:"100"},{default:l(({row:t})=>[a(Y,{type:t.role==="admin"?"danger":"info"},{default:l(()=>[u(pe(t.role==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),a(w,{prop:"enabled",label:"状态",width:"100"},{default:l(({row:t})=>{var v;return[a(G,{"model-value":t.enabled,onChange:x=>M(t,x),disabled:t.id===((v=d.value)==null?void 0:v.id)},null,8,["model-value","onChange","disabled"])]}),_:1}),a(w,{prop:"createdAt",label:"创建时间",width:"180"}),a(w,{label:"操作",width:"200",fixed:"right"},{default:l(({row:t})=>{var v;return[a(m,{size:"small",onClick:x=>z(t)},{default:l(()=>[...e[10]||(e[10]=[u(" 重置密码 ",-1)])]),_:1},8,["onClick"]),a(m,{size:"small",type:"danger",onClick:x=>N(t),disabled:t.id===((v=d.value)==null?void 0:v.id)},{default:l(()=>[...e[11]||(e[11]=[u(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]}),_:1})]),_:1},8,["data"])),[[K,E.value]]),a(F,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=t=>g.value=t),title:"添加用户",width:"400px"},{footer:l(()=>[a(m,{onClick:e[3]||(e[3]=t=>g.value=!1)},{default:l(()=>[...e[12]||(e[12]=[u("取消",-1)])]),_:1}),a(m,{type:"primary",onClick:A,loading:c.value},{default:l(()=>[...e[13]||(e[13]=[u("确定",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(D,{model:n,rules:q,ref_key:"createFormRef",ref:C,"label-width":"80px"},{default:l(()=>[a(y,{label:"用户名",prop:"username"},{default:l(()=>[a(h,{modelValue:n.username,"onUpdate:modelValue":e[0]||(e[0]=t=>n.username=t)},null,8,["modelValue"])]),_:1}),a(y,{label:"密码",prop:"password"},{default:l(()=>[a(h,{modelValue:n.password,"onUpdate:modelValue":e[1]||(e[1]=t=>n.password=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(y,{label:"角色",prop:"role"},{default:l(()=>[a(J,{modelValue:n.role,"onUpdate:modelValue":e[2]||(e[2]=t=>n.role=t),style:{width:"100%"}},{default:l(()=>[a($,{label:"普通用户",value:"user"}),a($,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(F,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=t=>_.value=t),title:"重置密码",width:"400px"},{footer:l(()=>[a(m,{onClick:e[6]||(e[6]=t=>_.value=!1)},{default:l(()=>[...e[14]||(e[14]=[u("取消",-1)])]),_:1}),a(m,{type:"primary",onClick:j,loading:c.value},{default:l(()=>[...e[15]||(e[15]=[u("确定",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(D,{model:i,rules:S,ref_key:"resetPasswordFormRef",ref:P,"label-width":"80px"},{default:l(()=>[a(y,{label:"新密码",prop:"newPassword"},{default:l(()=>[a(h,{modelValue:i.newPassword,"onUpdate:modelValue":e[5]||(e[5]=t=>i.newPassword=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Te=Q(Ee,[["__scopeId","data-v-4ae89fb5"]]);export{Te as default};
